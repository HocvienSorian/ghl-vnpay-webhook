<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Thanh To√°n VNPAY Th√†nh C√¥ng</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }
  </style>
</head>
<body>
  <h1>‚úÖ Thanh To√°n Th√†nh C√¥ng</h1>
  <p>H·ªá th·ªëng ƒëang x·ª≠ l√Ω giao d·ªãch...</p>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const vnp_ResponseCode = urlParams.get("vnp_ResponseCode");
  const vnp_TransactionNo = urlParams.get("vnp_TransactionNo");
  const vnp_TxnRef = urlParams.get("vnp_TxnRef");

  console.log("üì• ReturnUrl nh·∫≠n callback t·ª´ VNPAY:", {
    vnp_ResponseCode, vnp_TransactionNo, vnp_TxnRef
  });

  if (window.opener) {
    window.opener.postMessage({
      type: "vnpay_payment_complete",
      chargeId: vnp_TransactionNo,
      status: vnp_ResponseCode === "00" ? "success" : "fail"
    }, "*");

    console.log("üì§ G·ª≠i th√¥ng b√°o thanh to√°n v·ªÅ tab c≈©");
    window.close(); // ƒê√≥ng tab VNPAY sau khi g·ª≠i
  } else {
    console.warn("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y window.opener, user c√≥ th·ªÉ m·ªü tr·ª±c ti·∫øp.");
    document.body.innerHTML = "<h2>‚úÖ Thanh to√°n xong, b·∫°n c√≥ th·ªÉ quay v·ªÅ trang tr∆∞·ªõc.</h2>";
  }
</script>
</body>
</html>
